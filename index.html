<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OCR Camera Upload + Export</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h2 {
      margin-bottom: 10px;
    }
    label, button {
      display: inline-block;
      margin-top: 10px;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      border: none;
      margin-right: 10px;
    }
    label {
      background-color: #007bff;
      color: white;
    }
    button {
      background-color: #00c853;
      color: white;
    }
    button.secondary {
      background-color: #ff9800;
    }
    button.danger {
      background-color: #f44336;
    }
    input[type="file"] {
      display: none;
    }
    #output {
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      min-height: 100px;
    }
  </style>
</head>
<body>

  <h2>üì∑ OCR Camera + Export Tools</h2>
  <p>Take a picture to extract and export text.</p>

  <label for="cameraInput">üì∏ Open Camera</label>
  <input type="file" id="cameraInput" accept="image/*" capture="environment">

  <div id="output">Result will appear here...</div>

  <div style="margin-top: 20px;">
    <button onclick="copyText()">üìã Copy</button>
    <button class="secondary" onclick="downloadCSV()">‚¨áÔ∏è CSV</button>
    <button class="danger" onclick="downloadPDF()">üìÑ PDF</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const cameraInput = document.getElementById('cameraInput');
    const output = document.getElementById('output');

    let ocrText = ''; // to reuse for exports

    cameraInput.addEventListener('change', async function () {
      const file = cameraInput.files[0];
      if (!file) return;

      output.textContent = '‚è≥ Scanning...';

      const formData = new FormData();
      formData.append('file', file);
      formData.append('language', 'eng');
      formData.append('apikey', 'K81240037988957');  // üîÅ Replace with your OCR.space API key

      try {
        const response = await fetch('https://api.ocr.space/parse/image', {
          method: 'POST',
          body: formData
        });
        const result = await response.json();

        if (result.IsErroredOnProcessing) {
          output.textContent = '‚ùå Error: ' + result.ErrorMessage;
        } else {
          ocrText = result.ParsedResults[0].ParsedText || 'No text found.';
          output.textContent = ocrText;
        }
      } catch (error) {
        output.textContent = '‚ùå Network or API error.';
        console.error(error);
      }
    });

    function copyText() {
      navigator.clipboard.writeText(ocrText).then(() => {
        alert('‚úÖ Text copied to clipboard!');
      }).catch(err => {
        alert('‚ùå Copy failed.');
      });
    }

    function downloadCSV() {
      const csvContent = `"Extracted Text"\n"${ocrText.replace(/"/g, '""')}"`;
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "ocr-result.csv";
      link.click();
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const splitText = pdf.splitTextToSize(ocrText, 180);
      pdf.text(splitText, 10, 20);
      pdf.save("ocr-result.pdf");
    }
  </script>

</body>
</html>
