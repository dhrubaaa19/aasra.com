<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OCR.space Structured Scanner</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
      background: #f8f9fa;
    }
    input, button, textarea {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
    }
    video, img {
      max-width: 100%;
      display: block;
      margin: 10px auto;
    }
    textarea {
      width: 100%;
      height: 200px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h2>üì∑ OCR Structured Text Scanner</h2>

  <input type="file" id="fileInput" accept="image/*" />
  <button onclick="startCamera()">üì∏ Use Camera</button>
  <br />
  <video id="video" autoplay playsinline style="display:none;"></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <button id="captureBtn" style="display:none;" onclick="captureImage()">üì∏ Capture</button>
  <img id="preview" style="display:none;" />
  
  <button onclick="scanImage()">üîç Scan Image</button>

  <textarea id="ocrResult" placeholder="OCR result will appear here..."></textarea>
  <br />
  <button onclick="copyText()">üìã Copy</button>
  <button onclick="downloadCSV()">‚¨áÔ∏è CSV</button>
  <button onclick="downloadPDF()">‚¨áÔ∏è PDF</button>

  <script>
    let imageBlob = null;

    function startCamera() {
      const video = document.getElementById('video');
      const captureBtn = document.getElementById('captureBtn');
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          video.style.display = 'block';
          captureBtn.style.display = 'inline-block';
        });
    }

    function captureImage() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const preview = document.getElementById('preview');

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);

      video.srcObject.getTracks().forEach(track => track.stop());
      const dataURL = canvas.toDataURL('image/png');
      preview.src = dataURL;
      preview.style.display = 'block';

      fetch(dataURL)
        .then(res => res.blob())
        .then(blob => imageBlob = blob);

      video.style.display = 'none';
      document.getElementById('captureBtn').style.display = 'none';
    }

    document.getElementById('fileInput').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        imageBlob = file;
        const reader = new FileReader();
        reader.onload = e => {
          document.getElementById('preview').src = e.target.result;
          document.getElementById('preview').style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    function scanImage() {
      if (!imageBlob) {
        alert("Please select or capture an image first.");
        return;
      }

      const formData = new FormData();
      formData.append("file", imageBlob);
      formData.append("language", "eng");
      formData.append("isTable", "true");
      formData.append("OCREngine", "2");

      fetch("https://api.ocr.space/parse/image", {
        method: "POST",
        headers: {
          apikey: "K81240037988957"
        },
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          const parsed = data?.ParsedResults?.[0]?.ParsedText || "No text found.";
          document.getElementById("ocrResult").value = parsed.trim();
        })
        .catch(err => {
          console.error(err);
          alert("OCR failed.");
        });
    }

    function copyText() {
      const text = document.getElementById("ocrResult");
      text.select();
      document.execCommand("copy");
      alert("Copied to clipboard!");
    }

    function downloadCSV() {
      const text = document.getElementById("ocrResult").value;
      const blob = new Blob([text], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "ocr-output.csv";
      link.click();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const text = document.getElementById("ocrResult").value;
      const doc = new jsPDF();
      doc.text(text, 10, 10);
      doc.save("ocr-output.pdf");
    }
  </script>
</body>
</html>
